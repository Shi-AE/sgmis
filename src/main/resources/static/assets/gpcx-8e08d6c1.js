import{_ as U,N as s,F as w,d as c,M as I,G as _,r as d,o as B,c as P,f as l,t as o,b as u,H as z,C as m,p as D,a as F}from"./index-87c3fdd7.js";const E={data(){return{columns:[{title:"序号",dataIndex:"key"},{title:"鸽棚",dataIndex:"name",align:"right"},{title:"巢箱数量",dataIndex:"cxNumber",align:"right"},{title:"鸽子数量",dataIndex:"pigeonPopulation",align:"right"},{title:"操作",slotName:"operation",align:"right"}],data:[],form:{id:null,name:null,cxNumber:null,gid:null},inputModal:!1,updateModal:!1}},methods:{resetForm(){this.form={id:null,name:null,cxNumber:null,gid:null}},handleCancel(){this.$store.state.isPending?s.error("请求已发送，取消失败"):s.info("已取消"),this.resetForm()},checkData(){const t=!w(()=>{const{name:e,cxNumber:i}=this.form;if(!e||e.length===0)return s.error("请填写完整鸽棚名称"),!1;if(!i)this.form.cxNumber=0;else if(i<0||i>1e9)return s.error("数字范围错误"),!1;return!0});return t&&this.resetForm(),t},async handleUpdate(){if(this.checkData())return!0;await c({method:"PUT",url:"gpcx",data:this.form,message:"正在修改数据"}).then(t=>(t.data.code===200?(s.success(t.data.message),this.data=this.data.map(e=>(e.id===this.form.id&&(e.name=this.form.name,e.cxNumber=this.form.cxNumber),e))):s.error(t.data.message),this.resetForm(),!0)).catch(()=>{this.updateModal=!1})},async DeleteUserClick(t){let e=0,i=!1;if(await c({method:"GET",url:`gpcx/pigeon/${t.id}`,message:"正在查询影响到的鸽子数量"}).then(a=>{a.data.code===200?(e=a.data.data,i=!0):s.error(`${a.dat.message}，暂时无法删除，请重试`)}),!i)return;const f=I.warning({title:"删除鸽棚巢箱",content:()=>[_("div",`确认要删除"${t.name}"吗？`),_("div",`这将会影响到${e}只鸽子`),_("div",`${e}只鸽子将会被移出鸽棚巢箱`)],closable:!0,hideCancel:!1,onCancel:()=>{this.$store.state.isPending?s.error("请求已发送，取消失败"):s.info("已取消")},onBeforeOk:()=>{c({method:"DELETE",url:`gpcx/${t.id}`,message:"正在删除鸽棚巢箱"}).then(a=>{a.data.code===200?(s.success(`${a.data.message}，鸽棚巢箱中移除了${a.data.data}只鸽子`),this.data=this.data.filter(r=>r.id!==t.id)):s.error(a.data.message)}),f.close()}})},async handleInput(){if(this.checkData())return!0;await c({method:"POST",url:"gpcx",data:this.form,message:"正在上传信息"}).then(t=>(t.data.code===200?(s.success(t.data.message),console.log(this.fomr),this.data.unshift({key:this.data.length+1,...t.data.data})):s.error(t.data.message),this.resetForm(),!0)).catch(()=>{this.inputModal=!1})},UpdateClick(t){const{key:e,pigeonPopulation:i,...f}=t;this.form=f,this.updateModal=!0},checkPigeon(t){this.$router.push({name:"gzk",params:{name:t.name}})}},mounted(){c({method:"GET",url:"gpcx",message:"正在获取鸽棚巢箱信息"}).then(t=>{t.data.code===200&&(this.data=t.data.data.map((e,i)=>({key:i+1,...e})))})}},N=t=>(D("data-v-e1ba0e29"),t=t(),F(),t),O={class:"button-group"},T=N(()=>u("div",{class:"tip"},[u("div",null,"提示：巢箱数量填写0"),u("div",null,"视为大棚无巢箱")],-1)),S=N(()=>u("div",{class:"tip"},[u("div",null,"提示：巢箱数量填写0"),u("div",null,"视为大棚无巢箱"),u("div",null,"此修改只影响鸽棚名称和巢箱数量"),u("div",null,"不影响鸽棚内的鸽子")],-1));function G(t,e,i,f,a,r){const g=d("a-divider"),p=d("a-button"),b=d("a-space"),M=d("a-empty"),V=d("a-table"),x=d("a-input"),h=d("a-form-item"),v=d("a-input-number"),k=d("a-form"),y=d("a-modal");return B(),P(z,null,[l(g,{size:2,style:{"border-bottom-style":"dotted"},orientation:"left"},{default:o(()=>[m("操作")]),_:1}),u("div",O,[l(b,null,{default:o(()=>[l(p,{type:"primary",status:"success",onClick:e[0]||(e[0]=n=>a.inputModal=!0)},{default:o(()=>[m("新建巢箱")]),_:1})]),_:1})]),l(g,{size:2,style:{"border-bottom-style":"dotted"},orientation:"left"},{default:o(()=>[m("巢箱信息")]),_:1}),l(V,{columns:a.columns,data:a.data,pagination:!1},{empty:o(()=>[l(M,null,{default:o(()=>[m(" 还没有数据哦 ")]),_:1})]),operation:o(({record:n})=>[l(b,null,{default:o(()=>[l(p,{type:"outline",onClick:C=>r.UpdateClick(n)},{default:o(()=>[m("修改信息")]),_:2},1032,["onClick"]),l(p,{type:"outline",status:"danger",onClick:C=>r.DeleteUserClick(n)},{default:o(()=>[m("删除巢箱")]),_:2},1032,["onClick"]),l(p,{type:"outline",status:"success",onClick:C=>r.checkPigeon(n)},{default:o(()=>[m("查看鸽子")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["columns","data"]),l(y,{visible:a.inputModal,"onUpdate:visible":e[3]||(e[3]=n=>a.inputModal=n),width:"calc(300px + 0.1 * 100vw)",title:"新建鸽棚巢箱",onBeforeOk:r.handleInput,onCancel:r.handleCancel},{default:o(()=>[l(k,{model:a.form},{default:o(()=>[l(h,{field:"name",label:"鸽棚名称"},{default:o(()=>[l(x,{modelValue:a.form.name,"onUpdate:modelValue":e[1]||(e[1]=n=>a.form.name=n),modelModifiers:{lazy:!0},placeholder:"鸽棚名称"},null,8,["modelValue"])]),_:1}),l(h,{field:"cxNumber",label:"巢箱数量"},{default:o(()=>[l(v,{modelValue:a.form.cxNumber,"onUpdate:modelValue":e[2]||(e[2]=n=>a.form.cxNumber=n),modelModifiers:{lazy:!0},min:0,max:1e9,placeholder:"巢箱数量"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),T]),_:1},8,["visible","onBeforeOk","onCancel"]),l(y,{visible:a.updateModal,"onUpdate:visible":e[6]||(e[6]=n=>a.updateModal=n),width:"calc(300px + 0.1 * 100vw)",title:"修改鸽棚巢箱",onBeforeOk:r.handleUpdate,onCancel:r.handleCancel},{default:o(()=>[l(k,{model:a.form},{default:o(()=>[l(h,{field:"name",label:"鸽棚名称"},{default:o(()=>[l(x,{modelValue:a.form.name,"onUpdate:modelValue":e[4]||(e[4]=n=>a.form.name=n),modelModifiers:{lazy:!0},placeholder:"鸽棚名称"},null,8,["modelValue"])]),_:1}),l(h,{field:"cxNumber",label:"巢箱数量"},{default:o(()=>[l(v,{modelValue:a.form.cxNumber,"onUpdate:modelValue":e[5]||(e[5]=n=>a.form.cxNumber=n),modelModifiers:{lazy:!0},min:0,max:1e9,placeholder:"巢箱数量"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),S]),_:1},8,["visible","onBeforeOk","onCancel"])],64)}const L=U(E,[["render",G],["__scopeId","data-v-e1ba0e29"]]);export{L as default};

import{_ as B,N as a,M as v,G as f,d as m,r as i,o as M,c as P,f as n,t as o,b as r,H as N,C as c,p as V,a as E}from"./index-87c3fdd7.js";const O={data(){return{columns:[{title:"序号",dataIndex:"key"},{title:"成员用户名",dataIndex:"account",align:"center"},{title:"管理员权限",dataIndex:"admin",align:"right"},{title:"操作",slotName:"operation",align:"right"}],data:[],form:{gid:null,id:null,account:""},inputModal:!1}},methods:{resetForm(){this.form={gid:null,id:null,account:""}},handleCancel(){this.$store.state.isPending?a.error("请求已发送，取消失败"):a.info("已取消"),this.resetForm()},resetPasswordClick(t){if(t.isAdmin){a.error("无法修改管理员信息");return}const e=v.warning({title:"重置成员密码",content:()=>[f("div",`确认要重置成员${t.account}的密码吗？`),f("div","重置后密码初始值为“123456”"),f("div","成功后请尽快更换密码！")],closable:!0,hideCancel:!1,onCancel:()=>{this.$store.state.isPending?a.error("请求已发送，取消失败"):a.info("已取消")},onBeforeOk:()=>{m({method:"PUT",url:"user",data:{id:t.id,gid:t.gid},message:"正在重置用户密码"}).then(s=>{s.data.code===200?a.success(s.data.message):a.error(s.data.message),e.close()}).catch(()=>{e.close()})}})},DeleteUserClick(t){if(t.isAdmin){a.error("无法修改管理员信息");return}const e=v.warning({title:"删除成员",content:`确认要删除成员${t.account}吗？`,closable:!0,hideCancel:!1,onCancel:()=>{this.$store.state.isPending?a.error("请求已发送，取消失败"):a.info("已取消")},onBeforeOk:()=>{m({method:"DELETE",url:`user/${t.id}`,message:`正在删除${t.account}`}).then(s=>{s.data.code===200?(a.success(s.data.message),this.data=this.data.filter(p=>p.id!==t.id)):a.error(s.data.message),e.close()}).catch(()=>{e.close()})}})},async handleInput(){await m({method:"POST",url:"user",data:this.form}).then(t=>{if(t.data.code===200){a.success(t.data.message);const e=t.data.data;this.data.unshift({key:this.data.length+1,account:e.account,id:e.id,gid:e.gid,admin:e.admin?"管理员":"成员",isAdmin:e.admin})}else a.error(t.data.message);return!0}).catch(()=>!0)}},mounted(){m({method:"GET",url:"user",message:"正在查询成员"}).then(t=>{t.data.code===200?this.data=t.data.data.map((e,s)=>({account:e.account,key:s+1,id:e.id,gid:e.gid,admin:e.admin?"管理员":"成员",isAdmin:e.admin})):a.error("成员加载失败")})}},T=t=>(V("data-v-6974f805"),t=t(),E(),t),U={class:"button-group"},A=T(()=>r("div",{class:"tip"},[r("div",null,"注：成员密码初始值为“123456”"),r("div",null,"注册成功后请尽快更换密码"),r("div",null,"成员无法设置为管理员")],-1));function S(t,e,s,p,l,u){const h=i("a-divider"),_=i("a-button"),g=i("a-space"),y=i("a-empty"),C=i("a-table"),k=i("a-input"),b=i("a-form-item"),x=i("a-form"),w=i("a-modal");return M(),P(N,null,[n(h,{size:2,style:{"border-bottom-style":"dotted"},orientation:"left"},{default:o(()=>[c("操作")]),_:1}),r("div",U,[n(g,null,{default:o(()=>[n(_,{type:"primary",status:"success",onClick:e[0]||(e[0]=d=>l.inputModal=!0)},{default:o(()=>[c("新建成员")]),_:1})]),_:1})]),n(h,{size:2,style:{"border-bottom-style":"dotted"},orientation:"left"},{default:o(()=>[c("成员")]),_:1}),n(C,{columns:l.columns,data:l.data,pagination:!1,scroll:{minWidth:540}},{empty:o(()=>[n(y,null,{default:o(()=>[c(" 数据发生异常，请重试 ")]),_:1})]),operation:o(({record:d})=>[n(g,null,{default:o(()=>[n(_,{type:"primary",onClick:I=>u.resetPasswordClick(d)},{default:o(()=>[c("重置密码")]),_:2},1032,["onClick"]),n(_,{type:"primary",status:"danger",onClick:I=>u.DeleteUserClick(d)},{default:o(()=>[c("删除成员")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["columns","data"]),n(w,{visible:l.inputModal,"onUpdate:visible":e[2]||(e[2]=d=>l.inputModal=d),width:"calc(300px + 0.1 * 100vw)",title:"新建成员账号",onBeforeOk:u.handleInput,onCancel:u.handleCancel},{default:o(()=>[n(x,{model:l.form},{default:o(()=>[n(b,{field:"account",label:"成员用户名"},{default:o(()=>[n(k,{modelValue:l.form.account,"onUpdate:modelValue":e[1]||(e[1]=d=>l.form.account=d),modelModifiers:{lazy:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),A]),_:1},8,["visible","onBeforeOk","onCancel"])],64)}const D=B(O,[["render",S],["__scopeId","data-v-6974f805"]]);export{D as default};
